!function(c){"namespace sumo";c.fn.SumoSelect=function(f){var e=c.extend({placeholder:"Select Here",csvDispCount:3,captionFormat:"{0} Selected",floatWidth:400,forceCustomRendering:!1,nativeOnDevice:"Android;BlackBerry;iPhone;iPad;iPod;Opera Mini;IEMobile;Silk".split(";"),outputAsCSV:!1,csvSepChar:",",okCancelInMulti:!1,triggerChangeCombined:!0,selectAll:!1,selectAlltext:"Select All"},f);f=this.each(function(){var f=this;!this.sumo&&c(this).is("select")&&(this.sumo={E:c(f),is_multi:c(f).attr("multiple"),
select:"",caption:"",placeholder:"",optDiv:"",CaptionCont:"",is_floating:!1,is_opened:!1,mob:!1,Pstate:[],createElems:function(){var a=this;return a.E.wrap('<div class="SumoSelect" tabindex="0">'),a.select=a.E.parent(),a.caption=c("<span></span>"),a.CaptionCont=c('<p class="CaptionCont"><label><i></i></label></p>').addClass("SlectBox").attr("style",a.E.attr("style")).prepend(a.caption),a.select.append(a.CaptionCont),a.E.attr("disabled")&&a.select.addClass("disabled").removeAttr("tabindex"),e.outputAsCSV&&
a.is_multi&&a.E.attr("name")&&(a.select.append(c('<input class="HEMANT123" type="hidden" />').attr("name",a.E.attr("name")).val(a.getSelStr())),a.E.removeAttr("name")),a.isMobile()&&!e.forceCustomRendering?void a.setNativeMobile():(a.E.hide(),a.optDiv=c('<div class="optWrapper">'),a.floatingList(),ul=c('<ul class="options">'),a.optDiv.append(ul),e.selectAll&&a.selAll(),c(a.E.children("option")).each(function(b,d){d=c(d);a.createLi(d)}),a.is_multi&&a.multiSelelect(),a.select.append(a.optDiv),a.basicEvents(),
void a.selAllState())},createLi:function(a,b){return a.attr("value")||a.attr("value",a.val()),li=c('<li data-val="'+a.val()+'"><label>'+a.text()+"</label></li>"),this.is_multi&&li.prepend("<span><i></i></span>"),a[0].disabled&&(li=li.addClass("disabled")),this.onOptClick(li),a[0].selected&&li.addClass("selected"),a.attr("class")&&li.addClass(a.attr("class")),ul=this.optDiv.children("ul.options"),"undefined"==typeof b?ul.append(li):ul.children("li").eq(b).before(li),li},getSelStr:function(){return sopt=
[],this.E.children("option:selected").each(function(){sopt.push(c(this).val())}),sopt.join(e.csvSepChar)},multiSelelect:function(){var a=this;a.optDiv.addClass("multiple");a.okbtn=c('<p class="btnOk">OK</p>').click(function(){e.triggerChangeCombined&&(changed=!1,a.E.children("option:selected").length!=a.Pstate.length?changed=!0:a.E.children("option:selected").each(function(){0>a.Pstate.indexOf(c(this).val())&&(changed=!0)}),changed&&(a.E.trigger("change").trigger("click"),a.setText()));a.hideOpts()});
a.cancelBtn=c('<p class="btnCancel">Cancel</p>').click(function(){a._cnbtn();a.hideOpts()});a.optDiv.append(c('<div class="MultiControls">').append(a.okbtn).append(a.cancelBtn))},_cnbtn:function(){this.E.children("option:selected").each(function(){this.selected=!1});this.optDiv.find("li.selected").removeClass("selected");for(i=0;i<this.Pstate.length;i++)this.E.children('option[value="'+this.Pstate[i]+'"]')[0].selected=!0,this.optDiv.find('li[data-val="'+this.Pstate[i]+'"]').addClass("selected");this.selAllState()},
selAll:function(){var a=this;a.is_multi&&(a.chkAll=c("<i>"),a.selAll=c('<p class="select-all"><label>'+e.selectAlltext+"</label></p>").prepend(c("<span></span>").append(a.chkAll)),a.chkAll.on("click",function(){a.selAll.toggleClass("selected");a.optDiv.find("ul.options li").each(function(b,d){d=c(d);a.selAll.hasClass("selected")?d.hasClass("selected")||d.trigger("click"):d.hasClass("selected")&&d.trigger("click")})}),a.optDiv.prepend(a.selAll))},selAllState:function(){if(e.selectAll){var a=0,b=0;
this.optDiv.find("ul.options li").each(function(d,e){c(e).hasClass("selected")&&a++;c(e).hasClass("disabled")||b++});a==b?this.selAll.removeClass("partial").addClass("selected"):0==a?this.selAll.removeClass("selected partial"):this.selAll.addClass("partial")}},showOpts:function(){var a=this;a.E.attr("disabled")||(a.is_opened=!0,a.optDiv.addClass("open"),c(document).on("click.sumo",function(b){!a.select.is(b.target)&&0===a.select.has(b.target).length&&a.is_opened&&(a.hideOpts(),a.is_multi&&e.okCancelInMulti&&
a._cnbtn())}),a.is_floating&&(H=a.optDiv.children("ul").outerHeight()+2,a.is_multi&&(H+=parseInt(a.optDiv.css("padding-bottom"))),a.optDiv.css("height",H)),a.is_multi&&(a.is_floating||e.okCancelInMulti)&&(a.Pstate=[],a.E.children("option:selected").each(function(){a.Pstate.push(c(this).val())})))},hideOpts:function(){this.is_opened=!1;this.optDiv.removeClass("open").find("ul li.sel").removeClass("sel");c(document).off("click.sumo")},setOnOpen:function(){this.optDiv.find("ul li").eq(this.E[0].selectedIndex).addClass("sel");
this.showOpts()},nav:function(a){var b,d=this.optDiv.find("ul li.sel");if(this.is_opened&&d.length){if(!(b=a?d.prevAll("li:not(.disabled)"):d.nextAll("li:not(.disabled)"),!b.length)){d.removeClass("sel");d=b.first().addClass("sel");a=this.optDiv.find("ul");b=a.scrollTop();var c=d.position().top+b;c>=b+a.height()-d.outerHeight()&&a.scrollTop(c-a.height()+d.outerHeight());b>c&&a.scrollTop(c)}}else this.setOnOpen()},basicEvents:function(){var a=this;a.CaptionCont.click(function(b){a.E.trigger("click");
a.is_opened?a.hideOpts():a.showOpts();b.stopPropagation()});a.select.on("keydown",function(b){switch(b.which){case 38:a.nav(!0);break;case 40:a.nav(!1);break;case 32:case 13:a.is_opened?a.optDiv.find("ul li.sel").trigger("click"):a.setOnOpen();break;case 9:case 27:return a.is_multi&&e.okCancelInMulti&&a._cnbtn(),void a.hideOpts();default:return}b.preventDefault()});c(window).on("resize.sumo",function(){a.floatingList()})},onOptClick:function(a){var b=this;a.click(function(){var a=c(this);a.hasClass("disabled")||
(txt="",b.is_multi?(a.toggleClass("selected"),b.E.children('option[value="'+a.data("val")+'"]')[0].selected=a.hasClass("selected"),b.selAllState()):(a.parent().find("li.selected").removeClass("selected"),a.toggleClass("selected"),b.E.val(a.attr("data-val"))),b.is_multi&&e.triggerChangeCombined&&(b.is_floating||e.okCancelInMulti)||(b.setText(),b.E.trigger("change").trigger("click")),b.is_multi||b.hideOpts())})},setText:function(){if(this.placeholder="",this.is_multi){sels=this.E.children(":selected").not(":disabled");
for(i=0;i<sels.length;i++){if(i>=e.csvDispCount&&e.csvDispCount){this.placeholder=e.captionFormat.replace("{0}",sels.length);break}this.placeholder+=c(sels[i]).text()+", "}this.placeholder=this.placeholder.replace(/,([^,]*)$/,"$1")}else this.placeholder=this.E.children(":selected").not(":disabled").text();return is_placeholder=!1,this.placeholder||(is_placeholder=!0,this.placeholder=this.E.attr("placeholder"),this.placeholder||(this.placeholder=this.E.children("option:disabled:selected").text())),
this.placeholder=this.placeholder?this.placeholder:e.placeholder,this.caption.text(this.placeholder),csvField=this.select.find("input.HEMANT123"),csvField.length&&csvField.val(this.getSelStr()),is_placeholder?this.caption.addClass("placeholder"):this.caption.removeClass("placeholder"),this.placeholder},isMobile:function(){for(var a=navigator.userAgent||navigator.vendor||window.opera,b=0;b<e.nativeOnDevice.length;b++)if(0<a.toString().toLowerCase().indexOf(e.nativeOnDevice[b].toLowerCase()))return e.nativeOnDevice[b];
return!1},setNativeMobile:function(){var a=this;a.E.addClass("SelectClass");a.mob=!0;a.E.change(function(){a.setText()})},floatingList:function(){this.is_floating=c(window).width()<=e.floatWidth;this.optDiv.toggleClass("isFloating",this.is_floating);this.is_floating||this.optDiv.css("height","");this.optDiv.toggleClass("okCancelInMulti",e.okCancelInMulti&&!this.is_floating)},vRange:function(a){if(opts=this.E.children("option"),opts.length<=a||0>a)throw"index out of bounds";return this},toggSel:function(a,
b){var d=this.vRange(b);d.E.children("option")[b].disabled||(d.E.children("option")[b].selected=a,d.mob||d.optDiv.find("ul.options li").eq(b).toggleClass("selected",a),d.setText())},toggDis:function(a,b){var d=this.vRange(b);(d.E.children("option")[b].disabled=a)&&(d.E.children("option")[b].selected=!1);d.mob||d.optDiv.find("ul.options li").eq(b).toggleClass("disabled",a).removeClass("selected");d.setText()},toggSumo:function(a){return this.enabled=a,this.select.toggleClass("disabled",a),a?(this.E.attr("disabled",
"disabled"),this.select.removeAttr("tabindex")):(this.E.removeAttr("disabled"),this.select.attr("tabindex","0")),this},toggSelAll:function(a){var b=this;b.E.find("option").each(function(){b.E.find("option")[c(this).index()].disabled||(b.E.find("option")[c(this).index()].selected=a,b.mob||b.optDiv.find("ul.options li").eq(c(this).index()).toggleClass("selected",a),b.setText())});!b.mob&&e.selectAll&&b.selAll.removeClass("partial").toggleClass("selected",a)},reload:function(){var a=this.unload();return c(a).SumoSelect(e)},
unload:function(){return this.select.before(this.E),this.E.show(),e.outputAsCSV&&this.is_multi&&this.select.find("input.HEMANT123").length&&this.E.attr("name",this.select.find("input.HEMANT123").attr("name")),this.select.remove(),delete f.sumo,f},add:function(a,b,d){if("undefined"==typeof a)throw"No value to add";if(opts=this.E.children("option"),"number"==typeof b&&(d=b,b=a),"undefined"==typeof b&&(b=a),opt=c("<option></option>").val(a).html(b),opts.length<d)throw"index out of bounds";return"undefined"==
typeof d||opts.length==d?(this.E.append(opt),this.mob||this.createLi(opt)):(opts.eq(d).before(opt),this.mob||this.createLi(opt,d)),f},remove:function(a){var b=this.vRange(a);b.E.children("option").eq(a).remove();b.mob||b.optDiv.find("ul.options li").eq(a).remove();b.setText()},selectItem:function(a){this.toggSel(!0,a)},unSelectItem:function(a){this.toggSel(!1,a)},selectAll:function(){this.toggSelAll(!0)},unSelectAll:function(){this.toggSelAll(!1)},disableItem:function(a){this.toggDis(!0,a)},enableItem:function(a){this.toggDis(!1,
a)},enabled:!0,enable:function(){return this.toggSumo(!1)},disable:function(){return this.toggSumo(!0)},init:function(){return this.createElems(),this.setText(),this}},f.sumo.init())});return 1==f.length?f[0]:f}}(jQuery);(function(c){var f=c({});c.subscribe=function(){f.on.apply(f,arguments)};c.unsubscribe=function(){f.off.apply(f,arguments)};c.publish=function(){f.trigger.apply(f,arguments)}})(jQuery);
function BrunelEventHandlers(c){function f(){c.dataPreProcess(function(c){return c.filter(e.makeFilterStatement(c))})}var e;return{make_filter_handler:function(l){l||(l={});var a=l;e={filter:function(b,d,e){null==e&&(e=500);null!=b&&null!=d&&(a[b]=d,b=e,f(),c.rebuild(b))},makeFilterStatement:function(b){var d="",e;for(e in a){var f=a[e];if(b===c.data(null,f.datasetIndex)){if("range"===f.filter_type)d+=e+" in "+f.filter.min+", "+f.filter.max+(f.keepMissing?" || missing":"");else if("category"===f.filter_type){var j;
j=f.filter;var f=f.keepMissing,g=e+" is ",k=void 0;for(k in j)g+=j[k]+", ";j=g.substring(0,g.length-1)+(f?" || missing":"");d+=j}d+=";"}}return d.substring(0,d.length-1)}};f();$.subscribe("filter."+c.visId,function(a,d,c,f){e.filter(d,c,f)})}}};var BrunelJQueryControlFactory=function(){function c(b){return null!=a[b]&&null!=a[b].id}function f(b){clearInterval(a[b].id);$("#"+a[b].buttonId).button("option","icons",{primary:"ui-icon-play"});delete a[b].id}function e(b,d,e,p,j,g){$("#"+p).button("option","icons",{primary:"ui-icon-pause"});a[b]||(a[b]={index:0});a[b].buttonId=p;j&&(a[b].index=0);c(b)&&f(b);a[b].id=setInterval(function(){a[b].index<e.length-1?($("#"+d).slider({values:[e[a[b].index],e[a[b].index+1]]}),a[b].index++):a[b].index=
0},g)}function l(a){jQuery.contains(document,$("#"+a)[0])?$("#"+a).SumoSelect():setTimeout(function(){l(a)},100)}var a={};return{make_range_slider:function(b,d,l,p,j,g,k,m,s,h,n){null==n&&(n=500);null==h&&(h=4);var q=BrunelData.auto_NumericExtentDetail.makeForField(m),r=BrunelData.auto_Auto.makeNumericScale(q,!0,[0,0],0,h+1,!0).divisions,v="slider"+b+l,t="animateButton"+b+l,q=r[0],u=r[r.length-1];h=$("<div />").addClass("horizontal-box");$("<text  />").addClass("title").html(p).appendTo(h);s&&$("<div />",
{id:t}).button({text:!1,icons:{primary:"ui-icon-play"}}).click(function(){var d=c(b)&&a[b].buttonId===t;c(b)?(f(b),d||e(b,v,r,t,!0,n)):e(b,v,r,t,!1,n)}).appendTo(h);g||(g=q);k||(k=u);var x=$("<div />").appendTo(h).addClass("legend control-label control-left-label");x.html(m.format(g));var w=$("<div />").addClass("legend control-label");w.html(m.format(k));p=2<u-q?1:(u-q)/r.length;g=$("<div />",{id:v}).slider({range:!0,min:q,max:u,step:p,values:[g,k],slide:function(a,b){x.html(m.format(b.values[0]));
w.html(m.format(b.values[1]))},change:function(a,c){$.publish("filter."+b,[l,{filter:{min:c.values[0],max:c.values[1]},filter_type:"range",datasetIndex:d,keepMissing:j}],0.9*n)}});g=$("<div />").append(g);h.append(g);w.appendTo(h);return h},make_category_filter:function(a,c,e,f,j,g,k){var m=$("<select />",{multiple:"multiple"}).addClass("select-filter"),s=m.uniqueId().attr("id"),h=$("<div />").addClass("horizontal-box");$("<text  />").addClass("title").html(f).addClass("control-title").appendTo(h);
for(var n in g)f=k&&0<=k.indexOf(g[n])?!0:!1,k||(f="selected"),$("<option />",{value:n,text:g[n],selected:f}).appendTo(m);m.appendTo(h);$("body").on("change","#"+s,function(){var f=[];$("#"+s+" option:selected").each(function(){f.push($(this).text())});$.publish("filter."+a,[e,{filter:f,filter_type:"category",datasetIndex:c,keepMissing:j}])});l(s);return h}}}();
